sudo: required
language: ruby
cache:
  directories:
  - vendor/bundle
  - node_modules
rvm:
- 2.5.1
addons:
  postgresql: '9.6'
  chrome: stable
env:
  global:
  - RAILS_ENV=test
  - CC_TEST_REPORTER_ID=f39e060a8b1a558ebd8aff75d5b9760bf1ae98f3f85d628ae28814f3c66438cd
branches:
  only:
    - master
install:
- bundle install --path vendor/bundle
- bundle exec chromedriver-update
- yarn install
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
before_script:
- cp config/database.yml.travis config/database.yml
- psql -c 'create database travis_ci_test;' -U postgres
script:
- bundle exec rails webpacker:compile
- bundle exec rake db:schema:load
- "./cc-test-reporter before-build"
- bundle exec rspec spec
- "./cc-test-reporter format-coverage -t simplecov -o coverage/codeclimate.simplecov.json"
- yarn test
- "./cc-test-reporter format-coverage -t lcov -o coverage/codeclimate.lcov.json"
- "./cc-test-reporter sum-coverage coverage/codeclimate.*.json"
- "./cc-test-reporter upload-coverage"
- bundle exec bundle-audit update && bundle exec bundle-audit check
deploy:
  provider: heroku
  api_key: "$HEROKU_AUTH_TOKEN"
  app:
    master: practicaldev
  run:
  - rake db:migrate
after_deploy:
- bash after_deploy.sh
notifications:
  slack:
    on_pull_requests: false
    on_success: always
    secure: pBu4B+y2CTWYXFg+5Dmw+yg6nPVdYM8RShaBkqm/H1xtFbSaeHB4Pfi722Spw0qbRD0bq/AZjF9qxVJNsOXsCWrCsOBaLgwpU/QMZZOiF+Y+3RwZHkPWkKW2SYlIcMS4Hi3y1uCLt8w8mB2ks+RbTvB3HdgJdsiNCPyGZCG4MqQXWjLa2dUIWLpVuu/emJdAJ1I4dYr+jpm+LqFgb94w0WD5BnAVyUJLKZl1c/Iuyv4bMQXXy8rlkv/qfuw7UzIlSRpZaZHLJuzCBWWf3OEfgfUQKdphe8cKUenr6/v7qEwbky6JxMah+H8TnQ95tBxexnSrL1jHPNC5dJtyzrjCBtP3dylmgR7HMX+DKlIYhJ/gQeK75O+G/HTpyotw7FMaVkkOgueYLxh7NCz9fxRdVsltUeyes8wAohdrM1fgLkqS3Dm2eDIfVn+QnqrDqLMQ6nyuuefh4QQWlzL0eUoczc1Tg2HdiUbmZ0IPSayqipKNH2/WosHn7Zgrp7Pp1OUPHoWNWhSse3Zi6rzS7Q1l0F+jFFKSeRi6dyZykGFkqUQ+FjDytL52Ro8ZcwWKrmW2qjMo1Et6u8jwbh1Z709puXAo42QET+xbe4f56TKAxAzVp8JTgO7qf4Z13FGCbIsS5KyxyyQW6REuvj1j7/P7Jd7DNKA5Yu+/CjYNQPHaWvs=
